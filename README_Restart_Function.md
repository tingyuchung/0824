# 🎮 再挑戰一次功能說明

## 功能概述
遊戲現在已經整合了"再挑戰一次"功能，在分數0~3分的結局中，玩家可以點擊"再挑戰一次"選項來重新開始遊戲，**支持滑鼠點擊和鍵盤Enter鍵操作！**

## 🎯 功能特點

### 觸發條件
- **分數範圍**: 0~3分（低分數結局）
- **結局類型**: 
  - Game Over模式（時間結束或愛心歸零）
  - 生氣結局模式（低分數結局）

### 操作方式
- **滑鼠點擊**: 直接點擊"再挑戰一次"選項
- **鍵盤操作**: 按Enter鍵觸發（完全支持！）
- **即時響應**: 點擊或按Enter後立即重新開始遊戲
- **雙重支持**: 滑鼠和鍵盤操作完全同步

### 視覺效果
- **閃爍效果**: "再挑戰一次"選項有動態閃爍
- **選中狀態**: 選項周圍有 > < 符號包圍
- **像素風格**: 保持遊戲的像素藝術風格

## 🔧 技術實現

### 新增功能
1. **點擊區域**: 為"再挑戰一次"選項添加可點擊區域
2. **事件處理**: 處理滑鼠點擊和鍵盤事件（Enter鍵完全支持！）
3. **遊戲重啟**: 調用 `restartGame()` 函數重新開始遊戲
4. **雙重操作**: 滑鼠點擊和鍵盤Enter鍵功能完全一致

### 點擊區域計算
```javascript
// Game Over模式
ending.restartClickArea = {
  x: x - 20, // 添加邊距
  y: optionY - 30,
  w: textWidth + 40,
  h: 60
};

// 生氣結局模式
ending.restartClickArea = {
  x: x - textWidth/2 - 20, // 居中對齊
  y: optionY - 30,
  w: textWidth + 40,
  h: 60
};
```

### 事件處理邏輯
```javascript
// 檢查點擊是否在"再挑戰一次"選項區域內
if(ending.restartClickArea && 
   x >= ending.restartClickArea.x && 
   x <= ending.restartClickArea.x + ending.restartClickArea.w &&
   y >= ending.restartClickArea.y && 
   y <= ending.restartClickArea.y + ending.restartClickArea.h){
  // 重新開始遊戲
  restartGame();
}
```

## 📁 文件結構
```
johnny28birthday/
├── main.js                    # 主要遊戲邏輯（已整合新功能）
├── test_restart_function.html # 功能測試頁面
├── test_enter_key.html        # Enter鍵功能測試頁面
└── README_Restart_Function.md # 本說明文件
```

## 🧪 測試功能

### 方法1: 在遊戲中測試
1. 打開 `index.html`
2. 開始遊戲
3. **故意答錯問題**，讓分數降到3分以下
4. 在結局畫面點擊"再挑戰一次"
5. 確認遊戲重新開始

### 方法2: 使用測試頁面
1. 打開 `test_restart_function.html`
2. 查看功能說明和測試方法
3. 了解技術實現細節

### 方法3: 測試Enter鍵功能
1. 打開 `test_enter_key.html`
2. 了解Enter鍵的技術實現
3. 在實際遊戲中測試Enter鍵操作

## 🎮 使用流程

### 低分數結局流程
1. **遊戲結束** → 分數0~3分
2. **顯示結局** → Game Over或生氣結局
3. **出現選項** → "再挑戰一次"
4. **玩家選擇** → 點擊或按Enter
5. **遊戲重啟** → 重新開始遊戲

### 支持的結局模式
- **Game Over模式**: 時間結束或愛心歸零
- **生氣結局模式**: 低分數結局（≤3分）

## ⚠️ 注意事項

### 功能限制
- 只在分數0~3分的結局中顯示
- 高分數結局（≥4分）不顯示此選項
- 需要正確的遊戲狀態管理

### 技術要求
- 需要 `restartGame()` 函數
- 需要正確的點擊區域計算
- 需要事件處理邏輯

## 🔍 故障排除

### 點擊無效
1. 確認分數是否在0~3分範圍內
2. 檢查點擊區域是否正確計算
3. 確認事件處理器是否正確綁定

### Enter鍵無效
1. 確認是否在結局畫面（`state.mode === 'end'`）
2. 檢查菜單是否已顯示（`ending.menuAlpha > 0.5`）
3. 確認沒有其他鍵盤事件監聽器干擾
4. 檢查 `keys['Enter']` 狀態是否正確

### 遊戲無法重啟
1. 檢查 `restartGame()` 函數是否正確定義
2. 確認遊戲狀態重置邏輯
3. 檢查控制台是否有錯誤訊息

### 視覺問題
1. 確認"再挑戰一次"選項是否正確顯示
2. 檢查閃爍效果是否正常工作
3. 確認選中狀態樣式是否正確

## 🎨 自定義選項

### 修改點擊區域大小
```javascript
ending.restartClickArea = {
  x: x - 20, // 修改左邊距
  y: optionY - 30, // 修改上邊距
  w: textWidth + 40, // 修改寬度
  h: 60 // 修改高度
};
```

### 修改觸發條件
```javascript
// 可以修改分數範圍
if(ending.hearts <= 5) { // 改為5分以下
  ending.menuOptions = ['再挑戰一次'];
}
```

## 🔄 與其他功能的整合

### 背景音樂
- 重新開始遊戲時背景音樂繼續播放
- 不會中斷音樂循環

### 遊戲狀態
- 完全重置所有遊戲變數
- 重新初始化遊戲邏輯
- 重置計時器和愛心數量

### 問題系統
- 重新開始後問題順序重置
- 愛心數量重置為初始值

---

**開發者**: AI Assistant  
**最後更新**: 2025年1月  
**版本**: 1.0 - 再挑戰一次功能版
