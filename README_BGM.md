# 🎵 背景音樂功能說明

## 功能概述
遊戲現在已經整合了背景音樂功能，使用 `music/game_bgm.mp3` 文件作為遊戲的背景音樂。

## 🎮 音樂播放邏輯

### 自動播放時機
- **遊戲開始時**: 當玩家點擊"Start"開始遊戲時，背景音樂會自動開始播放
- **遊戲重新開始**: 每次重新開始遊戲時，背景音樂會重新開始播放
- **循環播放**: 背景音樂會無限循環播放，直到遊戲結束

### 自動停止時機
- **遊戲結束時**: 當遊戲進入結局畫面時，背景音樂會自動停止
- **返回主選單**: 當玩家返回開始畫面時，背景音樂會停止

### 暫停/恢復邏輯
- **對話期間**: 當顯示問題對話框或劇情對話時，背景音樂會暫停
- **對話結束**: 對話結束後，背景音樂會自動恢復播放
- **遊戲暫停**: 當遊戲暫停時，背景音樂也會暫停

## 🔧 技術實現

### 音頻控制函數
```javascript
// 初始化背景音樂
initBackgroundMusic()

// 播放背景音樂
playBackgroundMusic()

// 暫停背景音樂
pauseBackgroundMusic()

// 恢復背景音樂
resumeBackgroundMusic()

// 停止背景音樂
stopBackgroundMusic()

// 設置音量 (0.0 - 1.0)
setBackgroundMusicVolume(0.3)
```

### 音頻屬性
- **格式**: WAV
- **文件大小**: 41MB
- **預設音量**: 30%
- **循環播放**: 是
- **預加載**: 是

## 📁 文件結構
```
johnny28birthday/
├── music/
│   ├── game_bgm.mp3      # 主要背景音樂
│   ├── angry_bgm.wav     # 生氣結局音樂
│   └── gameover_bgm.mp3  # 遊戲結束音樂
├── main.js               # 主要遊戲邏輯（已整合音樂功能）
├── index.html            # 遊戲主頁面
└── test_audio.html       # 音樂功能測試頁面
```

## 🧪 測試音樂功能

### 方法1: 直接測試遊戲
1. 打開 `index.html`
2. 點擊"Start"開始遊戲
3. 背景音樂應該會自動開始播放

### 方法2: 使用測試頁面
1. 打開 `test_audio.html`
2. 使用按鈕測試各種音樂控制功能
3. 調整音量滑桿來改變音量

## ⚠️ 注意事項

### 瀏覽器限制
- 現代瀏覽器需要用戶交互才能播放音頻
- 某些瀏覽器可能會阻止自動播放
- 建議在遊戲開始時點擊按鈕來觸發音樂播放

### 音頻文件
- 確保 `music/game_bgm.mp3` 文件存在且可訪問
- 文件較大（41MB），首次加載可能需要一些時間
- 支持MP3格式，確保音頻質量

### 性能考慮
- 音頻文件已設置為預加載，減少播放延遲
- 音量預設為30%，避免過於突兀
- 循環播放不會增加內存使用

## 🎯 未來改進建議

1. **音量控制**: 在遊戲中添加音量調節選項
2. **音樂切換**: 根據遊戲階段切換不同的背景音樂
3. **音效管理**: 添加音效與背景音樂的混音控制
4. **用戶偏好**: 記住用戶的音量設置

## 🔍 故障排除

### 音樂無法播放
1. 檢查瀏覽器控制台是否有錯誤訊息
2. 確認音頻文件路徑正確
3. 嘗試刷新頁面重新加載
4. 檢查瀏覽器的音頻權限設置

### 音樂播放不穩定
1. 檢查網絡連接（如果音頻文件在遠程服務器）
2. 確認音頻文件沒有損壞
3. 嘗試降低音量設置
4. 檢查瀏覽器是否支持WAV格式

---

**開發者**: AI Assistant  
**最後更新**: 2025年1月  
**版本**: 1.0
