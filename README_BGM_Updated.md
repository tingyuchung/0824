# 🎵 背景音樂功能說明 (更新版)

## 功能概述
遊戲現在已經整合了背景音樂功能，使用 `music/game_bgm.mp3` 文件作為遊戲的背景音樂。**音樂會從主選單開始播放，一直播放到遊戲結束，實現無限輪播！**

## 🎮 音樂播放邏輯

### 自動播放時機
- **頁面加載完成**: 音樂會在頁面加載完成後1秒自動開始播放
- **主選單畫面**: 在主選單時音樂就已經在播放
- **遊戲進行中**: 音樂持續循環播放
- **遊戲結束**: 音樂繼續播放，不會停止
- **返回主選單**: 音樂繼續播放，不會停止

### 音量控制邏輯
- **正常遊戲**: 100%音量播放
- **對話期間**: 降低到30%音量（不會完全靜音）
- **對話結束**: 恢復到100%音量
- **無限循環**: 音樂會自動循環播放

### 音樂狀態管理
- **永不停止**: 音樂從開始到結束都不會停止
- **智能音量**: 根據遊戲狀態自動調整音量
- **無縫播放**: 音樂播放不會中斷

## 🔧 技術實現

### 音頻控制函數
```javascript
// 初始化背景音樂
initBackgroundMusic()

// 播放背景音樂
playBackgroundMusic()

// 降低背景音樂音量（用於對話期間）
lowerBackgroundMusicVolume()

// 恢復背景音樂音量
restoreBackgroundMusicVolume()

// 暫停背景音樂（保留功能，但主要使用音量控制）
pauseBackgroundMusic()

// 停止背景音樂（保留功能）
stopBackgroundMusic()

// 設置背景音樂音量 (0.0 - 1.0)
setBackgroundMusicVolume(0.3)
```

### 音頻屬性
- **格式**: WAV
- **文件大小**: 41MB
- **預設音量**: 30%
- **循環播放**: 是
- **預加載**: 是
- **永不停止**: 是

## 📁 文件結構
```
johnny28birthday/
├── music/
│   ├── game_bgm.mp3      # 主要背景音樂（無限循環）
│   ├── angry_bgm.wav     # 生氣結局音樂
│   └── gameover_bgm.mp3  # 遊戲結束音樂
├── main.js               # 主要遊戲邏輯（已整合音樂功能）
├── index.html            # 遊戲主頁面
├── test_audio.html       # 音樂功能測試頁面
└── debug_audio.html      # 音樂調試頁面
```

## 🧪 測試音樂功能

### 方法1: 直接測試遊戲
1. 打開 `index.html`
2. **音樂會在主選單就開始播放！**
3. 點擊"Start"開始遊戲
4. 音樂會持續播放到遊戲結束

### 方法2: 使用測試頁面
1. 打開 `test_audio.html`
2. 使用按鈕測試各種音樂控制功能
3. 調整音量滑桿來改變音量

### 方法3: 使用調試頁面
1. 打開 `debug_audio.html`
2. 查看詳細的音樂加載和播放狀態
3. 診斷可能的音樂問題

## ⚠️ 注意事項

### 瀏覽器限制
- 現代瀏覽器需要用戶交互才能播放音頻
- 音樂會在頁面加載後1秒自動開始播放
- 如果無法自動播放，點擊頁面任意位置即可觸發

### 音頻文件
- 確保 `music/game_bgm.mp3` 文件存在且可訪問
- 文件較大（41MB），首次加載可能需要一些時間
- 支持MP3格式，確保音頻質量

### 性能考慮
- 音頻文件已設置為預加載，減少播放延遲
- 音量預設為30%，避免過於突兀
- 循環播放不會增加內存使用

## 🎯 新功能特點

1. **從頭播到尾**: 音樂從主選單開始播放，不會停止
2. **智能音量控制**: 對話期間降低音量，對話結束恢復
3. **無縫循環**: 音樂會無限循環播放
4. **狀態感知**: 根據遊戲狀態自動調整音量
5. **用戶體驗**: 音樂持續播放，營造沉浸式遊戲體驗

## 🔍 故障排除

### 音樂無法播放
1. 檢查瀏覽器控制台是否有錯誤訊息
2. 確認音頻文件路徑正確
3. 嘗試刷新頁面重新加載
4. 檢查瀏覽器的音頻權限設置
5. 點擊頁面任意位置觸發播放

### 音樂播放不穩定
1. 檢查網絡連接（如果音頻文件在遠程服務器）
2. 確認音頻文件沒有損壞
3. 嘗試降低音量設置
4. 檢查瀏覽器是否支持WAV格式

### 音量控制問題
1. 確認對話期間音量是否降低
2. 檢查對話結束後音量是否恢復
3. 使用調試頁面檢查音樂狀態

---

**開發者**: AI Assistant  
**最後更新**: 2025年1月  
**版本**: 2.0 - 無限循環版
